import{_ as he,J as ke,u as Re,r as S,c as be,w as De,o as Ie,e as W,a as z,b as a,d as i,f as t,t as n,g as p,h as y,i as f,j as d,F as M,k as B,l as Ae,m as X,n as N,B as Ce,E as je,p as Fe,q as Le,s as Ne,v as q,x}from"./index-e08cc27a.js";const Se={name:"RfiActivityLog",components:{JsonViewer:ke},props:{projectId:{type:String,required:!0},itemId:{type:String,required:!0},autoLoad:{type:Boolean,default:!0}},emits:["loaded","error"],setup(_,{emit:s}){const{t:m}=Re(),e=S([]),C=S(null),V=S(null),j=S(null),F=S(!1),u=S(null),T=S(!1),D=be(()=>e.value.length),ee={rfi_created:"â—",rfi_submitted:"â†‘",rfi_opened:"â–¶",rfi_answered:"âœ“",rfi_closed:"â—‰",rfi_voided:"âœ•",status_changed:"â—†",comment_added:"â—‘",attachment_added:"â–²",response_submitted:"â– ",assignment_changed:"â—‡",priority_changed:"â—",due_date_changed:"â—‹",workflow_advanced:"â†’",review_requested:"â—Ž",review_completed:"âœ“",revision_requested:"â†»",approval_granted:"âœ“",rejection_issued:"âœ•"},te={rfi_created:"RFI Created",rfi_submitted:"RFI Submitted",rfi_opened:"RFI Opened",rfi_answered:"RFI Answered",rfi_closed:"RFI Closed",rfi_voided:"RFI Voided",status_changed:"Status Changed",comment_added:"Comment Added",attachment_added:"Attachment Added",response_submitted:"Response Submitted",assignment_changed:"Assignment Changed",priority_changed:"Priority Changed",due_date_changed:"Due Date Changed",workflow_advanced:"Workflow Advanced",review_requested:"Review Requested",review_completed:"Review Completed",revision_requested:"Revision Requested",approval_granted:"Approval Granted",rejection_issued:"Rejection Issued"},Z=(c,g)=>{const b=[...c];try{if(g.rfi){const l=g.rfi;l.created_at&&b.push({description:`RFI created: ${l.title||l.custom_identifier||"Untitled"}`,details:{status:l.status,priority:l.priority,workflow_type:l.workflow_type},event_type:"rfi_created",timestamp:l.created_at,user_id:l.created_by}),l.responded_at&&l.official_response&&b.push({description:"Official response submitted",details:{response_text:l.official_response,status:l.status},event_type:"response_submitted",timestamp:l.responded_at,user_id:l.responded_by}),l.closed_at&&b.push({description:"RFI closed",details:{status:"closed"},event_type:"rfi_closed",timestamp:l.closed_at,user_id:l.closed_by})}g.comments&&Array.isArray(g.comments)&&g.comments.forEach(l=>{if(l.created_at){let h=null;l.author&&(typeof l.author=="object"&&l.author.id?h=l.author.id:typeof l.author=="string"&&(h=l.author)),h||(h=l.created_by),console.log("ðŸ” å¤„ç†è¯„è®ºæ´»åŠ¨:",{åŽŸå§‹comment:l,æå–çš„authorId:h,authorç±»åž‹:typeof l.author,authorå€¼:l.author}),b.push({description:`Comment added${l.content?": "+(l.content.length>50?l.content.substring(0,50)+"...":l.content):""}`,details:{comment:l.content,comment_type:l.type||"comment"},event_type:"comment_added",timestamp:l.created_at,user_id:h})}}),g.attachments&&Array.isArray(g.attachments)&&g.attachments.forEach(l=>{(l.created_time||l.created_at)&&b.push({description:`Attachment added: ${l.name||l.fileName||"Unknown file"}`,details:{filename:l.name||l.fileName,file_size:l.file_size||l.fileSize,file_type:l.file_type||l.fileType,is_uploaded:!0},event_type:"attachment_added",timestamp:l.created_time||l.created_at,user_id:l.created_by||l.createdBy})}),b.sort((l,h)=>new Date(l.timestamp)-new Date(h.timestamp)),console.log("Enhanced RFI activities breakdown:",{original:c.length,enhanced:b.length,added:b.length-c.length})}catch(l){console.error("Error enhancing RFI activities:",l)}return b},se=c=>ee[c]||"ðŸ“",ne=c=>te[c]||c,k=c=>({rfi_created:"activity-created",rfi_submitted:"activity-submit",rfi_opened:"activity-open",rfi_answered:"activity-answered",rfi_closed:"activity-closed",rfi_voided:"activity-voided",status_changed:"activity-status",comment_added:"activity-comment",attachment_added:"activity-file",response_submitted:"activity-response",assignment_changed:"activity-assignment",priority_changed:"activity-priority",due_date_changed:"activity-date",workflow_advanced:"activity-workflow",review_requested:"activity-review",review_completed:"activity-completed",revision_requested:"activity-revision",approval_granted:"activity-approved",rejection_issued:"activity-rejected"})[c]||"activity-default",P=c=>({draft:"Draft",submitted:"Submitted",open:"Open",answered:"Answered",closed:"Closed",void:"Void"})[c]||c,O=c=>c?`priority-${c.toLowerCase()}`:"priority-normal",J=c=>({US:"Single Reviewer",EU:"Multi Reviewer",EMEA:"Multi Reviewer"})[c]||c||"Unknown",Y=c=>{if(!c)return"System";let g=c;if(typeof c=="object")if(c.id)g=c.id,console.warn("âš ï¸ getUserDisplayName æ”¶åˆ°å¯¹è±¡å‚æ•°ï¼Œå·²æå– id å­—æ®µ:",{åŽŸå§‹å¯¹è±¡:c,æå–çš„ID:g});else return console.error("âŒ getUserDisplayName æ”¶åˆ°æ— æ•ˆå¯¹è±¡å‚æ•°:",c),"Unknown User";const b=W.getUserDisplayName(g,_.projectId);if(b&&b!==g)return b;const l=Ae.getUserDisplayName(g);return l&&l!==g?l:g},G=(c,g)=>{var l,h;if(!c)return"Unassigned";if(console.log("ðŸ” RFI ActivityLogèŽ·å–åˆ†é…æ˜¾ç¤ºåç§°:",{assignedTo:c,assignedToType:g,projectId:_.projectId}),g==="role"&&((l=j.value)!=null&&l.projectRolesMapping)){const I=j.value.projectRolesMapping.find(U=>U.name===c);if(I){const U=((h=I.permittedAssignees)==null?void 0:h.length)||0;return`${{projectGC:"General Contractor",projectSC:"Subcontractor",projectCoordinator:"Construction Manager",projectReviewer:"Architect/Reviewer"}[c]||c} (${U} members)`}}const b=W.getAssignedToDisplayName(c,g,_.projectId);return console.log("âœ… RFI ActivityLogåˆ†é…æ˜¾ç¤ºåç§°ç»“æžœ:",{assignedTo:c,assignedToType:g,displayName:b}),b},H=c=>{if(!c)return"-";try{return new Date(c).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return c}},K=c=>{if(!c)return"-";try{return new Date(c).toLocaleDateString("en-US")}catch{return c}},Q=()=>{T.value=!T.value},E=async()=>{if(_.projectId)try{console.log("Loading RFI workflow config for project:",_.projectId);const c=await X.get(`/api/rfis/jarvis/workflow/${encodeURIComponent(_.projectId)}`);c.data&&c.data.success&&(j.value=c.data.workflow,console.log("RFI workflow config loaded:",j.value))}catch(c){console.warn("Failed to load RFI workflow config:",c)}},L=async()=>{var c,g,b;if(!_.projectId||!_.itemId){u.value="Missing required project ID or RFI ID";return}F.value=!0,u.value=null;try{console.log("Loading RFI activity log for:",_.projectId,_.itemId);const l=await X.get(`/api/rfis/jarvis/${encodeURIComponent(_.itemId)}/workflow-log`,{params:{projectId:_.projectId}});if(console.log("Raw RFI activity API response:",l.data),l.data){V.value=l.data;let h=[];l.data.success&&l.data.activities?(h=[...l.data.activities],console.log("Using RFI workflow activities:",h.length)):l.data.workflow_log&&l.data.workflow_log.activities&&(h=[...l.data.workflow_log.activities],console.log("Using raw RFI workflow activities:",h.length));const I=Z(h,l.data);e.value=I,console.log("Final enhanced RFI activities:",I.length),l.data.summary?C.value=l.data.summary:C.value={total_events:I.length,unique_users:[...new Set(I.map(U=>U.user_id).filter(Boolean))].length,has_comments:I.some(U=>U.event_type==="comment_added"),has_attachments:I.some(U=>U.event_type==="attachment_added"),first_activity:I.length>0?I[0].timestamp:null,last_activity:I.length>0?I[I.length-1].timestamp:null},console.log("RFI activity log loaded:",{activities:e.value.length,summary:C.value,rawDataKeys:Object.keys(l.data)}),s("loaded",{activities:e.value,summary:C.value,count:e.value.length,rawData:l.data})}else throw new Error("Invalid response data")}catch(l){if(console.error("Failed to load RFI activity log:",l),((c=l.response)==null?void 0:c.status)===404){console.log("Workflow log API not found, building from existing RFI data...");try{await ae()}catch{u.value="RFI activity log API not available and failed to build from existing data",s("error",u.value)}}else u.value=((b=(g=l.response)==null?void 0:g.data)==null?void 0:b.error)||l.message||"Failed to load RFI activity log",s("error",u.value)}finally{F.value=!1}},ae=async()=>{try{const[c,g,b]=await Promise.allSettled([X.get(`/api/rfis/jarvis/${_.itemId}`,{params:{projectId:_.projectId}}),X.get(`/api/rfis/jarvis/${_.itemId}/comments`,{params:{projectId:_.projectId}}),X.get(`/api/rfis/jarvis/${_.itemId}/attachments`,{params:{projectId:_.projectId}})]),l={};c.status==="fulfilled"&&c.value.data.success&&(l.rfi=c.value.data.rfi),g.status==="fulfilled"&&g.value.data.success&&(l.comments=g.value.data.comments),b.status==="fulfilled"&&b.value.data.success&&(l.attachments=b.value.data.attachments),V.value={built_from_existing_data:!0,...l};const h=Z([],l);e.value=h,C.value={total_events:h.length,unique_users:[...new Set(h.map(I=>I.user_id).filter(Boolean))].length,has_comments:h.some(I=>I.event_type==="comment_added"),has_attachments:h.some(I=>I.event_type==="attachment_added"),first_activity:h.length>0?h[0].timestamp:null,last_activity:h.length>0?h[h.length-1].timestamp:null},console.log("Built RFI activity log from existing data:",{activities:e.value.length,summary:C.value}),s("loaded",{activities:e.value,summary:C.value,count:e.value.length,rawData:V.value})}catch(c){throw console.error("Failed to build activity log from existing data:",c),c}};return De([()=>_.projectId,()=>_.itemId],()=>{_.autoLoad&&_.projectId&&_.itemId&&L()},{immediate:!0}),Ie(async()=>{if(_.projectId)try{console.log("ðŸ¢ RFI ActivityLogé¢„åŠ è½½å®žä½“ç¼“å­˜:",_.projectId),await Promise.all([W.getProjectEntities(_.projectId),E()]),console.log("âœ… RFI ActivityLogå®žä½“ç¼“å­˜å’Œå·¥ä½œæµé…ç½®é¢„åŠ è½½å®Œæˆ")}catch(c){console.warn("âš ï¸ RFI ActivityLogé¢„åŠ è½½å¤±è´¥:",c)}_.autoLoad&&_.projectId&&_.itemId&&L()}),{t:m,activities:e,summary:C,rawData:V,workflowConfig:j,loading:F,error:u,eventCount:D,showDebugSection:T,loadActivityLog:L,toggleDebugSection:Q,getActivityIcon:se,getActivityTypeText:ne,getActivityTypeClass:k,getStatusDisplayText:P,getPriorityClass:O,getWorkflowTypeDisplayName:J,getUserDisplayName:Y,getAssignedToDisplayName:G,formatDateTime:H,formatDate:K}}},Te={class:"rfi-activity-log"},Ee={key:0,class:"loading-state"},xe={key:1,class:"error-state"},Ue={key:2,class:"activity-log-container"},qe={class:"action-buttons"},Me={key:0,class:"activity-summary"},Be={class:"summary-cards"},ze={class:"summary-card"},Pe={class:"card-value"},We={class:"summary-card"},Ve={class:"card-value"},Oe={class:"summary-card"},Je={class:"card-value"},Ye={class:"summary-card"},Ge={class:"card-value"},He={key:0,class:"summary-card"},Ke={class:"card-value"},Qe={key:0,class:"timeline-info"},Xe={class:"timeline-item"},Ze={class:"timeline-value"},$e={class:"timeline-item"},et={class:"timeline-value"},tt={class:"activity-timeline"},st={key:0,class:"empty-state"},at={key:0},ot={class:"error-details"},it={key:1},nt={class:"info-details"},lt={key:2},rt={key:1,class:"timeline-list"},dt={class:"timeline-marker"},ct={class:"marker-icon"},mt={class:"timeline-content"},ut={class:"activity-header"},_t={class:"activity-description"},vt={class:"activity-time"},ft={class:"activity-meta"},yt={class:"activity-user"},gt={class:"activity-type"},wt={key:0,class:"activity-details"},pt={key:0,class:"detail-item comment"},ht={class:"detail-value comment-text"},kt={key:1,class:"detail-item file"},bt={class:"detail-value file-name"},It={key:0,class:"upload-status uploaded"},Rt={key:1,class:"upload-status pending"},Dt={key:2,class:"detail-item status-change"},At={class:"detail-value"},Ct={key:0,class:"status-from"},jt={key:1,class:"status-arrow"},Ft={key:2,class:"status-to"},Lt={key:3,class:"detail-item response"},Nt={class:"detail-value response-text"},St={key:4,class:"detail-item assigned"},Tt={class:"detail-value assigned-to"},Et={class:"assigned-name"},xt={class:"assigned-type"},Ut={class:"assigned-id"},qt={key:5,class:"detail-item priority"},Mt={class:"detail-value"},Bt={key:6,class:"detail-item due-date"},zt={class:"detail-value"},Pt={key:1,class:"debug-section"};function Wt(_,s,m,e,C,V){const j=z("el-button"),F=z("JsonViewer");return a(),i("div",Te,[e.loading?(a(),i("div",Ee,[s[0]||(s[0]=t("div",{class:"spinner"},null,-1)),t("p",null,n(e.t("rfi.activityLog.loading")||"Loading activity log..."),1)])):e.error?(a(),i("div",xe,[s[1]||(s[1]=t("div",{class:"error-icon"},"âš ï¸",-1)),t("h3",null,n(e.t("rfi.detailView.loadFailed")||"Failed to Load Activity Log"),1),t("p",null,n(e.error),1),p(j,{type:"primary",onClick:e.loadActivityLog},{default:y(()=>[f(n(e.t("rfi.actions.retry")||"Retry"),1)]),_:1},8,["onClick"])])):(a(),i("div",Ue,[t("div",qe,[p(j,{type:"primary",icon:e.loading?"Loading":"Refresh",loading:e.loading,onClick:e.loadActivityLog,size:"default"},{default:y(()=>[f(n(e.loading?"Loading...":"Refresh Activity Log"),1)]),_:1},8,["icon","loading","onClick"]),p(j,{type:"info",icon:"View",onClick:e.toggleDebugSection,size:"default"},{default:y(()=>[f(n(e.showDebugSection?"Hide":"Show")+" API Data ",1)]),_:1},8,["onClick"])]),e.summary?(a(),i("div",Me,[t("div",Be,[t("div",ze,[t("div",Pe,n(e.summary.total_events||0),1),s[2]||(s[2]=t("div",{class:"card-label"},"Total Events",-1))]),t("div",We,[t("div",Ve,n(e.summary.unique_users||0),1),s[3]||(s[3]=t("div",{class:"card-label"},"Participants",-1))]),t("div",Oe,[t("div",Je,n(e.summary.has_comments?"Yes":"No"),1),s[4]||(s[4]=t("div",{class:"card-label"},"Has Comments",-1))]),t("div",Ye,[t("div",Ge,n(e.summary.has_attachments?"Yes":"No"),1),s[5]||(s[5]=t("div",{class:"card-label"},"Has Attachments",-1))]),e.workflowConfig?(a(),i("div",He,[t("div",Ke,n(e.getWorkflowTypeDisplayName(e.workflowConfig.workflowType)),1),s[6]||(s[6]=t("div",{class:"card-label"},"Workflow Type",-1))])):d("",!0)]),e.summary.first_activity&&e.summary.last_activity?(a(),i("div",Qe,[t("div",Xe,[s[7]||(s[7]=t("span",{class:"timeline-label"},"First Activity:",-1)),t("span",Ze,n(e.formatDateTime(e.summary.first_activity)),1)]),t("div",$e,[s[8]||(s[8]=t("span",{class:"timeline-label"},"Latest Activity:",-1)),t("span",et,n(e.formatDateTime(e.summary.last_activity)),1)])])):d("",!0)])):d("",!0),t("div",tt,[e.activities.length===0?(a(),i("div",st,[s[17]||(s[17]=t("div",{class:"empty-icon"},"ðŸ“",-1)),s[18]||(s[18]=t("h3",null,"No Activity Records",-1)),e.rawData&&e.rawData.test_summary&&e.rawData.test_summary.has_errors?(a(),i("div",at,[s[12]||(s[12]=t("p",null,"API call encountered error, unable to retrieve activity data",-1)),t("div",ot,[t("p",null,[s[9]||(s[9]=t("strong",null,"Error Statistics:",-1)),f(" "+n(e.rawData.test_summary.error_count)+" errors",1)]),t("p",null,[s[10]||(s[10]=t("strong",null,"Success Rate:",-1)),f(" "+n(e.rawData.test_summary.success_rate),1)]),p(j,{size:"small",type:"primary",onClick:e.loadActivityLog},{default:y(()=>[...s[11]||(s[11]=[f("Reload",-1)])]),_:1},8,["onClick"])])])):e.rawData?(a(),i("div",it,[s[16]||(s[16]=t("p",null,"API call successful, but no activity data found",-1)),t("div",nt,[s[14]||(s[14]=t("p",null,[t("strong",null,"Data Structure:"),f(" Please check the raw API data above for details")],-1)),s[15]||(s[15]=t("p",null,[t("strong",null,"Tip:"),f(" Data may be in workflow_log or formatted_display fields")],-1)),p(j,{size:"small",type:"primary",onClick:e.loadActivityLog},{default:y(()=>[...s[13]||(s[13]=[f("Reload",-1)])]),_:1},8,["onClick"])])])):(a(),i("p",lt,"This RFI has no activity history yet"))])):(a(),i("div",rt,[(a(!0),i(M,null,B(e.activities,(u,T)=>(a(),i("div",{key:T,class:N(["timeline-item",e.getActivityTypeClass(u.event_type)])},[t("div",dt,[t("div",ct,n(e.getActivityIcon(u.event_type)),1)]),t("div",mt,[t("div",ut,[t("div",_t,n(u.description),1),t("div",vt,n(e.formatDateTime(u.timestamp)),1)]),t("div",ft,[t("span",yt,[s[19]||(s[19]=t("i",{class:"user-icon"},"ðŸ‘¤",-1)),f(" "+n(e.getUserDisplayName(u.user_id)||"System"),1)]),t("span",gt,n(e.getActivityTypeText(u.event_type)),1)]),u.details?(a(),i("div",wt,[u.details.comment?(a(),i("div",pt,[s[20]||(s[20]=t("div",{class:"detail-label"},"Comment:",-1)),t("div",ht,n(u.details.comment),1)])):d("",!0),u.details.filename?(a(),i("div",kt,[s[22]||(s[22]=t("div",{class:"detail-label"},"File:",-1)),t("div",bt,[s[21]||(s[21]=t("i",{class:"file-icon"},"ðŸ“Ž",-1)),f(" "+n(u.details.filename)+" ",1),u.details.is_uploaded?(a(),i("span",It,"Uploaded")):(a(),i("span",Rt,"Pending"))])])):d("",!0),u.details.from_status||u.details.to_status?(a(),i("div",Dt,[s[23]||(s[23]=t("div",{class:"detail-label"},"Status Change:",-1)),t("div",At,[u.details.from_status?(a(),i("span",Ct,n(e.getStatusDisplayText(u.details.from_status)),1)):d("",!0),u.details.from_status&&u.details.to_status?(a(),i("span",jt,"â†’")):d("",!0),u.details.to_status?(a(),i("span",Ft,n(e.getStatusDisplayText(u.details.to_status)),1)):d("",!0)])])):d("",!0),u.details.response_text?(a(),i("div",Lt,[s[24]||(s[24]=t("div",{class:"detail-label"},"Response:",-1)),t("div",Nt,n(u.details.response_text),1)])):d("",!0),u.details.assigned_to&&u.details.assigned_to_type?(a(),i("div",St,[s[25]||(s[25]=t("div",{class:"detail-label"},"Assigned to:",-1)),t("div",Tt,[t("span",Et,n(e.getAssignedToDisplayName(u.details.assigned_to,u.details.assigned_to_type)),1),t("span",xt,"("+n(u.details.assigned_to_type)+")",1),t("span",Ut,n(u.details.assigned_to),1)])])):d("",!0),u.details.priority?(a(),i("div",qt,[s[26]||(s[26]=t("div",{class:"detail-label"},"Priority:",-1)),t("div",Mt,[t("span",{class:N(["priority-badge",e.getPriorityClass(u.details.priority)])},n(u.details.priority),3)])])):d("",!0),u.details.due_date?(a(),i("div",Bt,[s[27]||(s[27]=t("div",{class:"detail-label"},"Due Date:",-1)),t("div",zt,n(e.formatDate(u.details.due_date)),1)])):d("",!0)])):d("",!0)])],2))),128))]))]),e.rawData&&e.showDebugSection?(a(),i("div",Pt,[p(F,{data:e.rawData,title:"ðŸ” Raw RFI Activity API Data",description:"Complete API response data including workflow logs, activities, and metadata","show-copy":!0,"show-download":!0,collapsible:!0,collapsed:!1,"expand-depth":2},null,8,["data"])])):d("",!0)]))])}const Vt=he(Se,[["render",Wt],["__scopeId","data-v-20bff57a"]]);const Ot={name:"RfiDetailView",components:{Breadcrumb:Ce,EntityReferences:je,JsonViewer:ke,RfiActivityLog:Vt},setup(){const _=Fe(),s=Le(),m=S(null),e=S([]),C=S([]),V=S(0),j=S(!1),F=S(!1),u=S(!1),T=S("details"),D=S({}),ee=be(()=>{const o=_.query.projectId,r=_.query.itemId;return{timestamp:new Date().toISOString(),projectId:o,itemId:r,endpoints:{item:{url:`/api/rfis/jarvis/${r}`,status:m.value?"success":"pending",hasData:!!m.value,dataSize:m.value?Object.keys(m.value).length:0},attachments:{url:`/api/rfis/jarvis/${r}/attachments`,status:"success",hasData:e.value.length>0,count:e.value.length},comments:{url:`/api/rfis/jarvis/${r}/comments`,status:"success",hasData:C.value.length>0,count:C.value.length}}}}),te=async()=>{j.value=!0;try{const o=_.query.projectId,r=_.query.itemId;if(!o||!r)throw new Error("Missing required parameters: projectId and itemId");console.log("Loading RFI data:",{projectId:o,itemId:r});const w=await X.get(`/api/rfis/jarvis/${r}`,{params:{projectId:o}});if(w.data.success)m.value=w.data.rfi,console.log("RFI data loaded:",m.value);else throw new Error(w.data.error||"Failed to load RFI data")}catch(o){console.error("Failed to load RFI detail:",o),q.error(`Failed to load RFI details: ${o.message}`)}finally{j.value=!1}},Z=async()=>{var o,r;if(!F.value){F.value=!0;try{const w=_.query.projectId,R=_.query.itemId,A=await X.get(`/api/rfis/jarvis/${R}/attachments`,{params:{projectId:w}});if(A.data.success){e.value=A.data.attachments||[];const v=A.data.stats||{};console.log("âœ… Attachments loaded:",e.value),console.log("ðŸ“Š Attachments stats:",v);let $=`Successfully loaded ${e.value.length} attachments`;v.duplicates_removed&&v.duplicates_removed>0&&($+=` (${v.duplicates_removed} duplicates removed)`,console.log(`ðŸ”„ Removed ${v.duplicates_removed} duplicate attachments`)),q.success($)}else throw new Error(A.data.error||"Failed to load attachments")}catch(w){console.error("Failed to load attachments:",w),q.error(((r=(o=w.response)==null?void 0:o.data)==null?void 0:r.error)||w.message||"Failed to load attachments")}finally{F.value=!1}}},se=async()=>{var o,r;if(!u.value){u.value=!0;try{const w=_.query.projectId,R=_.query.itemId,A=await X.get(`/api/rfis/jarvis/${R}/comments`,{params:{projectId:w}});if(console.log("ðŸ” Comments API Response:",A.data),console.log("ðŸ“Š Response Status:",A.status),console.log("ðŸ“‹ Response Headers:",A.headers),A.data.success)if(C.value=A.data.comments||[],console.log("âœ… Comments loaded:",C.value),console.log("ðŸ“Š Comments stats:",A.data.stats),C.value.length>0)q.success(`Successfully loaded ${C.value.length} comments`);else{const v=A.data.message||"No comments found for this RFI";q.info(v),console.log("â„¹ï¸ No comments found:",v)}else throw console.error("âŒ Comments API failed:",A.data),new Error(A.data.error||"Failed to load comments")}catch(w){console.error("Failed to load comments:",w),q.error(((r=(o=w.response)==null?void 0:o.data)==null?void 0:r.error)||w.message||"Failed to load comments")}finally{u.value=!1}}},ne=()=>{s.push({path:"/rfis/data",query:{projectId:_.query.projectId}})},k=o=>({draft:"Draft",open:"Open",answered:"Answered",closed:"Closed",void:"Void"})[o]||o||"Unknown",P=o=>`status-${o}`,O=o=>`priority-${(o==null?void 0:o.toLowerCase())||"normal"}`,J=o=>{if(!o)return"";const r=new Date(o),R=Math.ceil((r-new Date)/(1e3*60*60*24));return R<0?"overdue":R<=3?"due-soon":""},Y=o=>({US:"Single Reviewer",EMEA:"Multi Reviewer",EU:"Multi Reviewer"})[o]||o||"Unknown",G=o=>{if(!o)return"Unknown User";if(typeof o=="string")return W.getUserDisplayName(o,_.query.projectId)||o;if(o.id){const r=W.getUserDisplayName(o.id,_.query.projectId);if(r&&r!==o.id)return r}return o.name||o.email||o.id||"Unknown User"},H=o=>{if(!o||!o.id)return"Unassigned";const{id:r,type:w}=o;switch(w){case"user":return W.getUserDisplayName(r,_.query.projectId)||r;case"role":return W.getRoleDisplayName(r,_.query.projectId)||r;case"company":return W.getCompanyDisplayName(r,_.query.projectId)||r;default:return W.getEntityDisplayName(r,"auto",_.query.projectId)||r}},K=()=>{var o;return(o=m.value)!=null&&o.discipline?Array.isArray(m.value.discipline)?m.value.discipline:m.value.discipline.split(",").map(r=>r.trim()).filter(r=>r):[]},Q=()=>{var o;return(o=m.value)!=null&&o.category?Array.isArray(m.value.category)?m.value.category:m.value.category.split(",").map(r=>r.trim()).filter(r=>r):[]},E=o=>o?new Date(o).toLocaleDateString("en-US"):"",L=o=>{if(!o)return"0 B";const r=["B","KB","MB","GB"],w=Math.floor(Math.log(o)/Math.log(1024));return Math.round(o/Math.pow(1024,w)*100)/100+" "+r[w]},ae=o=>o?"test acc":"Unknown Type",c=(o,r)=>r===!0||r==="Yes"||r==="yes"?"impact-yes":r===!1||r==="No"||r==="no"?"impact-no":"impact-unknown",g=(o,r)=>r===!0||r==="Yes"||r==="yes"?"Yes":r===!1||r==="No"||r==="no"?"No":"Unknown",b=()=>{var o,r,w,R;return((r=(o=m.value)==null?void 0:o.raw_data)==null?void 0:r.coReviewers)&&m.value.raw_data.coReviewers.length>0||((R=(w=m.value)==null?void 0:w.raw_data)==null?void 0:R.watchers)&&m.value.raw_data.watchers.length>0},l=o=>o.type==="user"?"1 member":o.type==="company"?"company":o.type==="role"?"role":o.type,h=()=>{var r;if(!((r=m.value)!=null&&r.custom_attributes)||m.value.custom_attributes.length===0)return"-";const o=m.value.custom_attributes[0];return o.value&&o.value.length>10?"wee":o.value||o.name||"-"},I=()=>{var o;return!((o=m.value)!=null&&o.custom_attributes)||m.value.custom_attributes.length<2?"Custom Attribute 2":m.value.custom_attributes[1].name||"Custom Attribute 2"},U=()=>{var r;return!((r=m.value)!=null&&r.custom_attributes)||m.value.custom_attributes.length<2?"-":m.value.custom_attributes[1].value||"-"},le=()=>{var w,R,A;if(!((w=m.value)!=null&&w.raw_data))return 0;const o=((R=m.value.raw_data.responses)==null?void 0:R.length)||0,r=((A=m.value.raw_data.draftResponses)==null?void 0:A.length)||0;return o+r},re=o=>{switch(o){case"US":return"success";case"EU":case"EMEA":return"warning";default:return"info"}},de=()=>{var o;return(o=m.value)!=null&&o.raw_data?{workflowType:m.value.raw_data.workflowType,status:m.value.status,previousStatus:m.value.raw_data.previousStatus,assignedTo:m.value.assigned_to,reviewers:m.value.raw_data.reviewers,coReviewers:m.value.raw_data.coReviewers,watchers:m.value.raw_data.watchers,responses:m.value.raw_data.responses,draftResponses:m.value.raw_data.draftResponses,officialResponse:m.value.raw_data.officialResponse,officialResponseStatus:m.value.raw_data.officialResponseStatus,officialResponseActors:m.value.raw_data.officialResponseActors,permittedActions:m.value.raw_data.permittedActions,maxAssignees:m.value.raw_data.maxAssignees,timeline:{createdAt:m.value.created_at,updatedAt:m.value.updated_at,respondedAt:m.value.raw_data.respondedAt,answeredAt:m.value.raw_data.answeredAt,closedAt:m.value.closed_at}}:{}},ce=o=>{if(!o)return"el-icon-document";const r=o.toLowerCase();return{pdf:"el-icon-document",doc:"el-icon-document",docx:"el-icon-document",xls:"el-icon-s-grid",xlsx:"el-icon-s-grid",jpg:"el-icon-picture",jpeg:"el-icon-picture",png:"el-icon-picture",gif:"el-icon-picture",zip:"el-icon-folder-add",txt:"el-icon-document-copy",dwg:"el-icon-s-grid",cad:"el-icon-s-grid"}[r]||"el-icon-document"},me=async o=>{var r,w;try{D.value[o.id]=!0;const R=_.query.projectId,A=_.query.itemId,v=await X.get(`/api/rfis/jarvis/${A}/attachments/${o.id}/download`,{params:{projectId:R}});if(v.data.success){const $=v.data.download_url,pe=v.data.attachment_name||o.name,ie=document.createElement("a");ie.href=$,ie.download=pe,ie.target="_blank",document.body.appendChild(ie),ie.click(),document.body.removeChild(ie),q.success(`Started downloading ${pe}`)}else throw new Error(v.data.error||"Download failed")}catch(R){console.error("Download attachment failed:",R),q.error(`Download failed: ${((w=(r=R.response)==null?void 0:r.data)==null?void 0:w.error)||R.message}`)}finally{D.value[o.id]=!1}},ue=o=>{console.log("References loaded:",o),o.stats&&o.stats.total_references!==void 0&&(m.value.references_count=o.stats.total_references)},_e=o=>{console.error("References error:",o),q.error("Failed to load references")},ve=o=>{console.log("Reference download success:",o),q.success(`Successfully downloaded: ${o.documentName}`)},fe=o=>{console.error("Reference download error:",o),q.error(`Download failed: ${o.error}`)},ye=o=>{console.log("Activity log loaded:",o),V.value=o.count||0},ge=o=>{console.error("Activity log error:",o),q.error("Failed to load activity log")},oe=async()=>{const o=_.query.projectId,r=_.query.itemId;if(!o||!r){q.error("Missing required parameters: projectId and itemId");return}const w=[te(),Z(),se()];try{await Promise.allSettled(w),console.log("âœ… All RFI data loaded")}catch(R){console.error("âŒ Error loading RFI data:",R)}},we=async()=>{e.value=[],C.value=[],await oe(),q.success("Data refreshed successfully")};return Ie(async()=>{const o=_.query.projectId;o&&W.getProjectEntities(o).catch(r=>{console.warn("Failed to preload entity cache:",r)}),await oe()}),{item:m,attachments:e,comments:C,activityLogCount:V,loading:j,attachmentsLoading:F,commentsLoading:u,activeTab:T,downloadingAttachments:D,apiCallsInfo:ee,route:_,loadData:te,loadAttachments:Z,loadComments:se,loadAllData:oe,refreshAllData:we,goBack:ne,onReferencesLoaded:ue,onReferencesError:_e,onDownloadSuccess:ve,onDownloadError:fe,onActivityLogLoaded:ye,onActivityLogError:ge,getStatusText:k,getStatusClass:P,getPriorityClass:O,getDueDateClass:J,getWorkflowTypeText:Y,getUserDisplayName:G,getAssignedEntityDisplayName:H,getDisciplineArray:K,getCategoryArray:Q,formatDate:E,formatDateTime:Ne,formatFileSize:L,getFileIcon:ce,downloadAttachment:me,getRfiTypeDisplayName:ae,getImpactClass:c,getImpactText:g,hasCoReviewersOrWatchers:b,getEntityMemberCount:l,getCustomAttributeDisplayValue:h,getSecondCustomAttributeName:I,getSecondCustomAttributeValue:U,getWorkflowResponsesCount:le,getWorkflowTypeTagType:re,getWorkflowData:de}}},Jt={class:"rfi-detail-view"},Yt={class:"page-actions"},Gt={class:"back-button"},Ht={class:"action-buttons"},Kt={key:0,class:"loading-container"},Qt={key:1,class:"detail-container"},Xt={class:"page-header-section"},Zt={class:"header-title"},$t={class:"item-id-badge"},es={class:"status-summary"},ts={class:"summary-row"},ss={class:"summary-item"},as={class:"summary-item"},os={class:"summary-row"},is={class:"summary-item"},ns={class:"value"},ls={class:"summary-item"},rs={class:"tabs-container"},ds={class:"tab-content"},cs={class:"info-grid"},ms={class:"info-section"},us={class:"info-rows"},_s={class:"info-row"},vs={class:"info-value"},fs={key:0,class:"info-row"},ys={class:"info-value"},gs={key:1,class:"info-row"},ws={class:"info-value"},ps={key:2,class:"info-row"},hs={class:"info-value"},ks={key:3,class:"info-row"},bs={class:"info-value"},Is={class:"info-section"},Rs={class:"info-rows"},Ds={key:0,class:"info-row"},As={class:"info-value"},Cs={key:1,class:"info-row"},js={class:"info-value"},Fs={key:2,class:"info-row"},Ls={class:"info-value"},Ns={key:3,class:"info-row"},Ss={class:"info-value watchers-value"},Ts={class:"watchers-count"},Es={class:"watchers-list"},xs={key:0,class:"more-watchers"},Us={class:"info-section full-width"},qs={class:"info-rows dates-grid"},Ms={key:0,class:"info-row"},Bs={class:"info-value"},zs={key:1,class:"info-row"},Ps={class:"info-value"},Ws={key:2,class:"info-row"},Vs={class:"info-value"},Os={key:3,class:"info-row"},Js={class:"info-value"},Ys={key:4,class:"info-row"},Gs={class:"info-value"},Hs={class:"info-section full-width"},Ks={class:"info-rows impact-grid"},Qs={class:"info-row"},Xs={class:"info-value"},Zs={class:"info-row"},$s={class:"info-value"},ea={class:"info-section full-width"},ta={class:"info-rows"},sa={class:"info-row"},aa={class:"info-value"},oa={class:"info-row"},ia={class:"info-value"},na={key:0,class:"info-row"},la={class:"info-value"},ra={class:"info-section full-width"},da={class:"info-rows additional-info-grid"},ca={class:"info-row"},ma={class:"info-value"},ua={key:0,class:"info-row"},_a={class:"info-value"},va={key:1,class:"info-row"},fa={class:"info-value"},ya={key:2,class:"info-row"},ga={class:"info-value"},wa={key:3,class:"info-row"},pa={class:"info-value"},ha={key:4,class:"info-row"},ka={class:"info-label"},ba={class:"info-value"},Ia={key:0,class:"info-section full-width"},Ra={class:"description-box"},Da={key:0,class:"question-content"},Aa={key:1,class:"description-content"},Ca={key:1,class:"info-section full-width"},ja={class:"response-box"},Fa={key:0,class:"suggested-answer"},La={key:1,class:"official-response"},Na={key:0,class:"response-meta"},Sa={class:"response-author"},Ta={class:"response-time"},Ea={class:"tab-json-viewer"},xa={key:0,class:"tab-badge"},Ua={class:"tab-content"},qa={key:0,class:"loading-state"},Ma={key:1},Ba={class:"attachments-header"},za={class:"header-left"},Pa={class:"header-right"},Wa={key:0,class:"attachments-grid"},Va={class:"attachment-icon"},Oa={class:"attachment-details"},Ja={class:"attachment-name"},Ya={class:"attachment-meta"},Ga={class:"attachment-type"},Ha={class:"attachment-size"},Ka={key:0,class:"attachment-time"},Qa={class:"attachment-actions"},Xa={key:1,class:"no-attachments"},Za={class:"tab-json-viewer"},$a={key:0,class:"tab-badge"},eo={class:"tab-content"},to={key:0,class:"tab-badge"},so={class:"tab-content"},ao={key:0,class:"tab-badge"},oo={class:"tab-content"},io={class:"workflow-overview"},no={class:"workflow-header"},lo={class:"workflow-type-badge"},ro={class:"status-timeline"},co={class:"timeline-content"},mo={key:0,class:"timeline-time"},uo={key:1,class:"timeline-status"},_o={class:"timeline-content"},vo={class:"timeline-subtitle"},fo={key:0,class:"timeline-time"},yo={key:1,class:"timeline-status"},go={class:"timeline-content"},wo={key:0,class:"timeline-time"},po={key:1,class:"timeline-status"},ho={class:"timeline-dot"},ko={class:"timeline-content"},bo={class:"timeline-title"},Io={key:0,class:"timeline-time"},Ro={key:1,class:"timeline-status"},Do={key:0,class:"responses-section"},Ao={class:"responses-list"},Co={class:"response-header"},jo={class:"response-meta"},Fo={class:"response-status"},Lo={class:"response-state"},No={class:"response-time"},So={class:"response-content"},To={class:"response-text"},Eo={class:"response-author"},xo={key:0},Uo={key:1,class:"responses-section"},qo={class:"responses-list"},Mo={class:"response-header"},Bo={class:"response-meta"},zo={class:"response-status"},Po={class:"response-state"},Wo={class:"response-time"},Vo={class:"response-content"},Oo={class:"response-text"},Jo={class:"response-author"},Yo={key:0},Go={class:"workflow-participants"},Ho={class:"participants-grid"},Ko={key:0,class:"participant-group"},Qo={class:"participant-list"},Xo={key:1,class:"participant-group"},Zo={class:"participant-list"},$o={key:2,class:"participant-group"},ei={class:"participant-list"},ti={key:3,class:"participant-group"},si={class:"participant-list"},ai={key:0,class:"more-participants"},oi={class:"tab-json-viewer"},ii={key:0,class:"tab-badge"},ni={class:"tab-content"},li={class:"comments-header"},ri={class:"header-left"},di={class:"header-right"},ci={key:0,class:"loading-state"},mi={key:1,class:"comments-list"},ui={class:"comment-header"},_i={class:"comment-author-info"},vi={class:"comment-author"},fi={class:"comment-meta"},yi={class:"comment-time"},gi={class:"comment-content"},wi={key:0,class:"comment-text"},pi={key:1,class:"comment-empty"},hi={key:2,class:"no-comments"},ki={class:"tab-json-viewer"},bi={class:"tab-content"},Ii={class:"json-viewers-container"},Ri={class:"json-section"},Di={key:0,class:"json-section"},Ai={key:1,class:"json-section"},Ci={class:"json-section"},ji={key:2,class:"error-state"};function Fi(_,s,m,e,C,V){const j=z("Breadcrumb"),F=z("el-button"),u=z("JsonViewer"),T=z("el-tab-pane"),D=z("el-tag"),ee=z("el-empty"),te=z("EntityReferences"),Z=z("RfiActivityLog"),se=z("el-alert"),ne=z("el-tabs");return a(),i("div",Jt,[p(j),t("div",Yt,[t("div",Gt,[p(F,{onClick:e.goBack,icon:"ArrowLeft"},{default:y(()=>[...s[1]||(s[1]=[f("Back to RFI List",-1)])]),_:1},8,["onClick"])]),t("div",Ht,[p(F,{type:"primary",icon:"Refresh",loading:e.loading||e.attachmentsLoading||e.commentsLoading,onClick:e.refreshAllData},{default:y(()=>[...s[2]||(s[2]=[f(" Refresh All Data ",-1)])]),_:1},8,["loading","onClick"])])]),e.loading?(a(),i("div",Kt,[...s[3]||(s[3]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading RFI details...",-1)])])):e.item?(a(),i("div",Qt,[t("div",Xt,[t("div",Zt,[t("h1",null,[s[4]||(s[4]=t("span",{class:"title-icon"},"ðŸ“‹",-1)),f(" "+n(e.item.title||e.item.display_name||"Untitled RFI"),1)]),t("div",$t,n(e.item.custom_identifier||e.item.id),1)]),t("div",es,[t("div",ts,[t("div",ss,[s[5]||(s[5]=t("span",{class:"label"},"Status",-1)),t("span",{class:N(["status-badge",e.getStatusClass(e.item.status)])},n(e.getStatusText(e.item.status)),3)]),t("div",as,[s[6]||(s[6]=t("span",{class:"label"},"Priority",-1)),t("span",{class:N(["priority-badge",e.getPriorityClass(e.item.priority)])},n(e.item.priority||"Normal"),3)])]),t("div",os,[t("div",is,[s[7]||(s[7]=t("span",{class:"label"},"Workflow Type",-1)),t("span",ns,n(e.getWorkflowTypeText(e.item.workflow_type)),1)]),t("div",ls,[s[8]||(s[8]=t("span",{class:"label"},"Due Date",-1)),t("span",{class:N(["due-date",e.getDueDateClass(e.item.due_date)])},n(e.formatDate(e.item.due_date)||"-"),3)])])])]),t("div",rs,[p(ne,{modelValue:e.activeTab,"onUpdate:modelValue":s[0]||(s[0]=k=>e.activeTab=k),type:"card"},{default:y(()=>[p(T,{label:"Details",name:"details"},{default:y(()=>{var k,P,O,J,Y,G,H,K,Q;return[t("div",ds,[t("div",cs,[t("div",ms,[s[14]||(s[14]=t("h3",{class:"section-title"},"Basic Information",-1)),t("div",us,[t("div",_s,[s[9]||(s[9]=t("span",{class:"info-label"},"RFI ID",-1)),t("span",vs,n(e.item.id),1)]),e.item.custom_identifier?(a(),i("div",fs,[s[10]||(s[10]=t("span",{class:"info-label"},"Custom ID",-1)),t("span",ys,n(e.item.custom_identifier),1)])):d("",!0),e.item.display_id?(a(),i("div",gs,[s[11]||(s[11]=t("span",{class:"info-label"},"Display ID",-1)),t("span",ws,n(e.item.display_id),1)])):d("",!0),(k=e.item.raw_data)!=null&&k.rfiTypeId?(a(),i("div",ps,[s[12]||(s[12]=t("span",{class:"info-label"},"RFI Type",-1)),t("span",hs,n(e.getRfiTypeDisplayName(e.item.raw_data.rfiTypeId)),1)])):d("",!0),e.item.workflow_type?(a(),i("div",ks,[s[13]||(s[13]=t("span",{class:"info-label"},"Workflow Type",-1)),t("span",bs,n(e.getWorkflowTypeText(e.item.workflow_type)),1)])):d("",!0)])]),t("div",Is,[s[19]||(s[19]=t("h3",{class:"section-title"},"People & Roles",-1)),t("div",Rs,[e.item.created_by?(a(),i("div",Ds,[s[15]||(s[15]=t("span",{class:"info-label"},"Creator",-1)),t("span",As,n(e.getUserDisplayName(e.item.created_by)),1)])):d("",!0),e.item.assigned_to&&e.item.assigned_to.length>0?(a(),i("div",Cs,[s[16]||(s[16]=t("span",{class:"info-label"},"Ball in court",-1)),t("span",js,[(a(!0),i(M,null,B(e.item.assigned_to,(E,L)=>(a(),i("span",{key:L,class:"assignee-tag"},n(e.getAssignedEntityDisplayName(E)),1))),128))])])):d("",!0),(P=e.item.raw_data)!=null&&P.coReviewers&&e.item.raw_data.coReviewers.length>0?(a(),i("div",Fs,[s[17]||(s[17]=t("span",{class:"info-label"},"Co-reviewers",-1)),t("span",Ls,[(a(!0),i(M,null,B(e.item.raw_data.coReviewers,(E,L)=>(a(),i("span",{key:L,class:"co-reviewer-tag"},n(e.getAssignedEntityDisplayName(E))+" ("+n(e.getEntityMemberCount(E))+") ",1))),128))])])):d("",!0),(O=e.item.raw_data)!=null&&O.watchers&&e.item.raw_data.watchers.length>0?(a(),i("div",Ns,[s[18]||(s[18]=t("span",{class:"info-label"},"Watchers",-1)),t("span",Ss,[t("span",Ts,"("+n(e.item.raw_data.watchers.length)+")",1),t("div",Es,[(a(!0),i(M,null,B(e.item.raw_data.watchers.slice(0,3),(E,L)=>(a(),i("span",{key:L,class:"watcher-tag"},n(e.getAssignedEntityDisplayName(E)),1))),128)),e.item.raw_data.watchers.length>3?(a(),i("span",xs," +"+n(e.item.raw_data.watchers.length-3)+" more ",1)):d("",!0)])])])):d("",!0)])]),t("div",Us,[s[25]||(s[25]=t("h3",{class:"section-title"},"Timeline",-1)),t("div",qs,[e.item.created_at?(a(),i("div",Ms,[s[20]||(s[20]=t("span",{class:"info-label"},"Created Date",-1)),t("span",Bs,n(e.formatDateTime(e.item.created_at)),1)])):d("",!0),e.item.updated_at?(a(),i("div",zs,[s[21]||(s[21]=t("span",{class:"info-label"},"Last Updated",-1)),t("span",Ps,n(e.formatDateTime(e.item.updated_at)),1)])):d("",!0),e.item.due_date?(a(),i("div",Ws,[s[22]||(s[22]=t("span",{class:"info-label"},"Due Date",-1)),t("span",Vs,n(e.formatDateTime(e.item.due_date)),1)])):d("",!0),e.item.responded_at?(a(),i("div",Os,[s[23]||(s[23]=t("span",{class:"info-label"},"Response Date",-1)),t("span",Js,n(e.formatDateTime(e.item.responded_at)),1)])):d("",!0),e.item.closed_at?(a(),i("div",Ys,[s[24]||(s[24]=t("span",{class:"info-label"},"Closed Date",-1)),t("span",Gs,n(e.formatDateTime(e.item.closed_at)),1)])):d("",!0)])]),t("div",Hs,[s[28]||(s[28]=t("h3",{class:"section-title"},"Impact Assessment",-1)),t("div",Ks,[t("div",Qs,[s[26]||(s[26]=t("span",{class:"info-label"},"Cost Impact",-1)),t("span",Xs,[t("span",{class:N(["impact-badge",e.getImpactClass("cost",(J=e.item.impact_analysis)==null?void 0:J.has_cost_impact)])},n(e.getImpactText("cost",(Y=e.item.impact_analysis)==null?void 0:Y.has_cost_impact)),3)])]),t("div",Zs,[s[27]||(s[27]=t("span",{class:"info-label"},"Schedule Impact",-1)),t("span",$s,[t("span",{class:N(["impact-badge",e.getImpactClass("schedule",(G=e.item.impact_analysis)==null?void 0:G.has_schedule_impact)])},n(e.getImpactText("schedule",(H=e.item.impact_analysis)==null?void 0:H.has_schedule_impact)),3)])])])]),t("div",ea,[s[32]||(s[32]=t("h3",{class:"section-title"},"Location Information",-1)),t("div",ta,[t("div",sa,[s[29]||(s[29]=t("span",{class:"info-label"},"Location",-1)),t("span",aa,n(e.item.location_description||"Unspecified"),1)]),t("div",oa,[s[30]||(s[30]=t("span",{class:"info-label"},"Location details",-1)),t("span",ia,n(e.item.location_description||"location"),1)]),e.item.locations&&e.item.locations.length>0?(a(),i("div",na,[s[31]||(s[31]=t("span",{class:"info-label"},"Structured Locations",-1)),t("span",la,[(a(!0),i(M,null,B(e.item.locations,(E,L)=>(a(),i("span",{key:L,class:"location-tag"},n(E.name||`Location ${L+1}`),1))),128))])])):d("",!0)])]),t("div",ra,[s[38]||(s[38]=t("h3",{class:"section-title"},"Additional Information",-1)),t("div",da,[t("div",ca,[s[33]||(s[33]=t("span",{class:"info-label"},"Priority",-1)),t("span",ma,[t("span",{class:N(["priority-badge",e.getPriorityClass(e.item.priority)])},n(e.item.priority||"Normal"),3)])]),e.item.reference||(K=e.item.raw_data)!=null&&K.reference?(a(),i("div",ua,[s[34]||(s[34]=t("span",{class:"info-label"},"External ID",-1)),t("span",_a,n(e.item.reference||((Q=e.item.raw_data)==null?void 0:Q.reference)||"-"),1)])):d("",!0),e.item.discipline?(a(),i("div",va,[s[35]||(s[35]=t("span",{class:"info-label"},"Discipline",-1)),t("span",fa,n(e.item.discipline),1)])):d("",!0),e.item.custom_attributes&&e.item.custom_attributes.length>0?(a(),i("div",ya,[s[36]||(s[36]=t("span",{class:"info-label"},"Custom Attribute",-1)),t("span",ga,n(e.getCustomAttributeDisplayValue()),1)])):d("",!0),e.item.category?(a(),i("div",wa,[s[37]||(s[37]=t("span",{class:"info-label"},"Category",-1)),t("span",pa,n(e.item.category),1)])):d("",!0),e.item.custom_attributes&&e.item.custom_attributes.length>1?(a(),i("div",ha,[t("span",ka,n(e.getSecondCustomAttributeName()),1),t("span",ba,n(e.getSecondCustomAttributeValue()),1)])):d("",!0)])]),e.item.question||e.item.description?(a(),i("div",Ia,[s[43]||(s[43]=t("h3",{class:"section-title"},"Question & Description",-1)),t("div",Ra,[e.item.question?(a(),i("div",Da,[s[39]||(s[39]=t("strong",null,"Question:",-1)),s[40]||(s[40]=t("br",null,null,-1)),f(" "+n(e.item.question),1)])):d("",!0),e.item.description&&e.item.description!==e.item.question?(a(),i("div",Aa,[s[41]||(s[41]=t("strong",null,"Description:",-1)),s[42]||(s[42]=t("br",null,null,-1)),f(" "+n(e.item.description),1)])):d("",!0)])])):d("",!0),e.item.official_response||e.item.suggested_answer?(a(),i("div",Ca,[s[48]||(s[48]=t("h3",{class:"section-title"},"Response Information",-1)),t("div",ja,[e.item.suggested_answer?(a(),i("div",Fa,[s[44]||(s[44]=t("strong",null,"Suggested Answer:",-1)),s[45]||(s[45]=t("br",null,null,-1)),f(" "+n(e.item.suggested_answer),1)])):d("",!0),e.item.official_response?(a(),i("div",La,[s[46]||(s[46]=t("strong",null,"Official Response:",-1)),s[47]||(s[47]=t("br",null,null,-1)),f(" "+n(e.item.official_response)+" ",1),e.item.responded_by?(a(),i("div",Na,[t("span",Sa,n(e.getUserDisplayName(e.item.responded_by)),1),t("span",Ta,n(e.formatDateTime(e.item.responded_at)),1)])):d("",!0)])):d("",!0)])])):d("",!0)]),t("div",Ea,[e.item?(a(),x(u,{key:0,data:e.item,title:"RFI Basic Data",description:"Complete RFI information including all fields and metadata","show-copy":!0,"show-download":!0,collapsible:!0,collapsed:!0},null,8,["data"])):d("",!0)])])]}),_:1}),p(T,{name:"attachments"},{label:y(()=>[s[49]||(s[49]=f(" Attachments ",-1)),e.attachments&&e.attachments.length?(a(),i("span",xa,"("+n(e.attachments.length)+")",1)):d("",!0)]),default:y(()=>[t("div",Ua,[e.attachmentsLoading?(a(),i("div",qa,[...s[50]||(s[50]=[t("div",{class:"spinner-small"},null,-1),t("p",null,"Loading attachments...",-1)])])):(a(),i("div",Ma,[t("div",Ba,[t("div",za,[e.attachments&&e.attachments.length>0?(a(),x(D,{key:0,type:"success",size:"small"},{default:y(()=>[f(" Loaded "+n(e.attachments.length)+" Attachments ",1)]),_:1})):e.attachments&&e.attachments.length===0?(a(),x(D,{key:1,type:"info",size:"small"},{default:y(()=>[...s[51]||(s[51]=[f(" No Attachments Available ",-1)])]),_:1})):(a(),x(D,{key:2,type:"warning",size:"small"},{default:y(()=>[...s[52]||(s[52]=[f(" Attachments Not Loaded ",-1)])]),_:1}))]),t("div",Pa,[p(F,{type:"primary",size:"small",icon:"Refresh",loading:e.attachmentsLoading,onClick:e.loadAttachments},{default:y(()=>[f(n(e.attachments?"Refresh":"Load")+" Attachments ",1)]),_:1},8,["loading","onClick"])])]),e.attachments&&e.attachments.length>0?(a(),i("div",Wa,[(a(!0),i(M,null,B(e.attachments,k=>(a(),i("div",{key:k.id,class:"attachment-card"},[t("div",Va,[t("i",{class:N(e.getFileIcon(k.file_type))},null,2)]),t("div",Oa,[t("div",Ja,n(k.name),1),t("div",Ya,[t("span",Ga,n(k.file_type),1),t("span",Ha,n(e.formatFileSize(k.file_size)),1)]),k.created_time?(a(),i("div",Ka,n(e.formatDateTime(k.created_time)),1)):d("",!0)]),t("div",Qa,[p(F,{type:"primary",size:"mini",icon:"el-icon-download",onClick:P=>e.downloadAttachment(k),loading:e.downloadingAttachments[k.id]},{default:y(()=>[...s[53]||(s[53]=[f(" Download ",-1)])]),_:1},8,["onClick","loading"])])]))),128))])):e.attachments&&e.attachments.length===0?(a(),i("div",Xa,[p(ee,{description:"No attachments available"})])):d("",!0),t("div",Za,[e.attachments?(a(),x(u,{key:0,data:e.attachments,title:"Attachments Data",description:"JSON data of current RFI's attachments list","show-copy":!0,"show-download":!0,collapsible:!0,collapsed:!0},null,8,["data"])):d("",!0)])]))])]),_:1}),p(T,{name:"references"},{label:y(()=>[s[54]||(s[54]=f(" References ",-1)),e.item&&e.item.references_count&&e.item.references_count>0?(a(),i("span",$a,"("+n(e.item.references_count)+")",1)):d("",!0)]),default:y(()=>[t("div",eo,[e.item&&e.route.query.projectId?(a(),x(te,{key:0,entity:e.item,project:{id:e.route.query.projectId},"entity-type":"rfi","auto-load":!0,"show-debug-info":!1,"show-json-viewer":!1,"supported-reference-types":["document","file","drawing","photo","issue","specification"],onReferencesLoaded:e.onReferencesLoaded,onReferencesError:e.onReferencesError,onDownloadSuccess:e.onDownloadSuccess,onDownloadError:e.onDownloadError},null,8,["entity","project","onReferencesLoaded","onReferencesError","onDownloadSuccess","onDownloadError"])):d("",!0)])]),_:1}),p(T,{name:"activity-log"},{label:y(()=>[s[55]||(s[55]=f(" Activity Log ",-1)),e.activityLogCount>0?(a(),i("span",to,"("+n(e.activityLogCount)+")",1)):d("",!0)]),default:y(()=>[t("div",so,[e.item&&e.route.query.projectId?(a(),x(Z,{key:0,"project-id":e.route.query.projectId,"item-id":e.route.query.itemId,"auto-load":!0,onLoaded:e.onActivityLogLoaded,onError:e.onActivityLogError},null,8,["project-id","item-id","onLoaded","onError"])):d("",!0)])]),_:1}),p(T,{name:"workflow"},{label:y(()=>[s[56]||(s[56]=f(" Workflow & Responses ",-1)),e.getWorkflowResponsesCount()>0?(a(),i("span",ao,"("+n(e.getWorkflowResponsesCount())+")",1)):d("",!0)]),default:y(()=>{var k,P,O,J,Y,G,H,K,Q,E,L,ae,c,g,b,l,h,I,U,le,re,de,ce,me,ue,_e,ve,fe,ye,ge,oe,we,o,r,w,R,A;return[t("div",oo,[t("div",io,[t("div",no,[s[57]||(s[57]=t("h3",{class:"section-title"},"RFI Workflow Status",-1)),t("div",lo,[p(D,{type:e.getWorkflowTypeTagType((P=(k=e.item)==null?void 0:k.raw_data)==null?void 0:P.workflowType),size:"large"},{default:y(()=>{var v,$;return[f(n(e.getWorkflowTypeText(($=(v=e.item)==null?void 0:v.raw_data)==null?void 0:$.workflowType))+" Workflow ",1)]}),_:1},8,["type"])])]),t("div",ro,[t("div",{class:N(["timeline-item",{active:((O=e.item)==null?void 0:O.status)==="draft",completed:((J=e.item)==null?void 0:J.status)!=="draft"&&((Y=e.item)==null?void 0:Y.created_at)}])},[s[59]||(s[59]=t("div",{class:"timeline-dot"},[t("i",{class:"timeline-icon el-icon-edit-outline"})],-1)),t("div",co,[s[58]||(s[58]=t("div",{class:"timeline-title"},"Draft",-1)),(G=e.item)!=null&&G.created_at?(a(),i("div",mo,n(e.formatDateTime(e.item.created_at)),1)):d("",!0),((H=e.item)==null?void 0:H.status)==="draft"?(a(),i("div",uo,"Current Status")):d("",!0)])],2),t("div",{class:N(["timeline-connector",{active:["submitted","open","openRev1","openRev2","answered","answeredRev1","answeredManager","closed","void"].includes((K=e.item)==null?void 0:K.status)}])},null,2),t("div",{class:N(["timeline-item",{active:["submitted","open","openRev1","openRev2"].includes((Q=e.item)==null?void 0:Q.status),completed:["answered","answeredRev1","answeredManager","closed","void"].includes((E=e.item)==null?void 0:E.status)}])},[s[61]||(s[61]=t("div",{class:"timeline-dot"},[t("i",{class:"timeline-icon el-icon-view"})],-1)),t("div",_o,[s[60]||(s[60]=t("div",{class:"timeline-title"},"Under Review",-1)),t("div",vo,n(e.getStatusText((L=e.item)==null?void 0:L.status)),1),(ae=e.item)!=null&&ae.updated_at?(a(),i("div",fo,n(e.formatDateTime(e.item.updated_at)),1)):d("",!0),["submitted","open","openRev1","openRev2"].includes((c=e.item)==null?void 0:c.status)?(a(),i("div",yo,"Current Status")):d("",!0)])],2),t("div",{class:N(["timeline-connector",{active:["answered","answeredRev1","answeredManager","closed","void"].includes((g=e.item)==null?void 0:g.status)}])},null,2),t("div",{class:N(["timeline-item",{active:["answered","answeredRev1","answeredManager"].includes((b=e.item)==null?void 0:b.status),completed:["closed","void"].includes((l=e.item)==null?void 0:l.status)}])},[s[63]||(s[63]=t("div",{class:"timeline-dot"},[t("i",{class:"timeline-icon el-icon-check"})],-1)),t("div",go,[s[62]||(s[62]=t("div",{class:"timeline-title"},"Answered",-1)),(I=(h=e.item)==null?void 0:h.raw_data)!=null&&I.answeredAt?(a(),i("div",wo,n(e.formatDateTime(e.item.raw_data.answeredAt)),1)):d("",!0),["answered","answeredRev1","answeredManager"].includes((U=e.item)==null?void 0:U.status)?(a(),i("div",po,"Current Status")):d("",!0)])],2),t("div",{class:N(["timeline-connector",{active:["closed","void"].includes((le=e.item)==null?void 0:le.status)}])},null,2),t("div",{class:N(["timeline-item",{active:["closed","void"].includes((re=e.item)==null?void 0:re.status)}])},[t("div",ho,[t("i",{class:N(["timeline-icon",((de=e.item)==null?void 0:de.status)==="void"?"el-icon-close":"el-icon-circle-check"])},null,2)]),t("div",ko,[t("div",bo,n(((ce=e.item)==null?void 0:ce.status)==="void"?"Voided":"Closed"),1),(me=e.item)!=null&&me.closed_at?(a(),i("div",Io,n(e.formatDateTime(e.item.closed_at)),1)):d("",!0),["closed","void"].includes((ue=e.item)==null?void 0:ue.status)?(a(),i("div",Ro,"Current Status")):d("",!0)])],2)])]),(ve=(_e=e.item)==null?void 0:_e.raw_data)!=null&&ve.responses&&e.item.raw_data.responses.length>0?(a(),i("div",Do,[s[66]||(s[66]=t("h3",{class:"section-title"},"Official Responses",-1)),t("div",Ao,[(a(!0),i(M,null,B(e.item.raw_data.responses,v=>(a(),i("div",{key:v.id,class:"response-item official"},[t("div",Co,[t("div",jo,[p(D,{type:"success",size:"small"},{default:y(()=>[...s[64]||(s[64]=[f("Official Response",-1)])]),_:1}),t("span",Fo,n(v.status),1),t("span",Lo,n(v.state),1)]),t("div",No,n(e.formatDateTime(v.createdAt)),1)]),t("div",So,[t("div",To,n(v.text||"No content provided"),1),t("div",Eo,[s[65]||(s[65]=t("strong",null,"By:",-1)),f(" "+n(e.getUserDisplayName(v.createdBy))+" ",1),v.onBehalf&&v.onBehalf!==v.createdBy?(a(),i("span",xo," (on behalf of "+n(e.getUserDisplayName(v.onBehalf))+") ",1)):d("",!0)])])]))),128))])])):d("",!0),(ye=(fe=e.item)==null?void 0:fe.raw_data)!=null&&ye.draftResponses&&e.item.raw_data.draftResponses.length>0?(a(),i("div",Uo,[s[70]||(s[70]=t("h3",{class:"section-title"},"Draft Responses",-1)),t("div",qo,[(a(!0),i(M,null,B(e.item.raw_data.draftResponses,v=>(a(),i("div",{key:v.id,class:"response-item draft"},[t("div",Mo,[t("div",Bo,[p(D,{type:"warning",size:"small"},{default:y(()=>[...s[67]||(s[67]=[f("Draft Response",-1)])]),_:1}),t("span",zo,n(v.status),1),t("span",Po,n(v.state),1),v.isEditable?(a(),x(D,{key:0,type:"info",size:"mini"},{default:y(()=>[...s[68]||(s[68]=[f("Editable",-1)])]),_:1})):d("",!0)]),t("div",Wo,n(e.formatDateTime(v.createdAt)),1)]),t("div",Vo,[t("div",Oo,n(v.text||"No content provided"),1),t("div",Jo,[s[69]||(s[69]=t("strong",null,"By:",-1)),f(" "+n(e.getUserDisplayName(v.createdBy))+" ",1),v.onBehalf&&v.onBehalf!==v.createdBy?(a(),i("span",Yo," (on behalf of "+n(e.getUserDisplayName(v.onBehalf))+") ",1)):d("",!0)])])]))),128))])])):d("",!0),t("div",Go,[s[74]||(s[74]=t("h3",{class:"section-title"},"Workflow Participants",-1)),t("div",Ho,[(ge=e.item)!=null&&ge.assigned_to&&e.item.assigned_to.length>0?(a(),i("div",Ko,[s[71]||(s[71]=t("h4",null,"Currently Assigned To",-1)),t("div",Qo,[(a(!0),i(M,null,B(e.item.assigned_to,v=>(a(),i("div",{key:v.id,class:"participant-item assigned"},[p(D,{type:"primary",size:"small"},{default:y(()=>[f(n(e.getAssignedEntityDisplayName(v)),1)]),_:2},1024)]))),128))])])):d("",!0),(we=(oe=e.item)==null?void 0:oe.raw_data)!=null&&we.reviewers&&e.item.raw_data.reviewers.length>0?(a(),i("div",Xo,[s[72]||(s[72]=t("h4",null,"Reviewers",-1)),t("div",Zo,[(a(!0),i(M,null,B(e.item.raw_data.reviewers,v=>(a(),i("div",{key:v.id,class:"participant-item reviewer"},[p(D,{type:"success",size:"small"},{default:y(()=>[f(n(e.getAssignedEntityDisplayName(v)),1)]),_:2},1024)]))),128))])])):d("",!0),(r=(o=e.item)==null?void 0:o.raw_data)!=null&&r.coReviewers&&e.item.raw_data.coReviewers.length>0?(a(),i("div",$o,[s[73]||(s[73]=t("h4",null,"Co-Reviewers",-1)),t("div",ei,[(a(!0),i(M,null,B(e.item.raw_data.coReviewers,v=>(a(),i("div",{key:v.id,class:"participant-item co-reviewer"},[p(D,{type:"warning",size:"small"},{default:y(()=>[f(n(e.getAssignedEntityDisplayName(v)),1)]),_:2},1024)]))),128))])])):d("",!0),(R=(w=e.item)==null?void 0:w.raw_data)!=null&&R.watchers&&e.item.raw_data.watchers.length>0?(a(),i("div",ti,[t("h4",null,"Watchers ("+n(e.item.raw_data.watchers.length)+")",1),t("div",si,[(a(!0),i(M,null,B(e.item.raw_data.watchers.slice(0,5),v=>(a(),i("div",{key:v.id,class:"participant-item watcher"},[p(D,{type:"info",size:"small"},{default:y(()=>[f(n(e.getAssignedEntityDisplayName(v)),1)]),_:2},1024)]))),128)),e.item.raw_data.watchers.length>5?(a(),i("div",ai," +"+n(e.item.raw_data.watchers.length-5)+" more... ",1)):d("",!0)])])):d("",!0)])]),t("div",oi,[(A=e.item)!=null&&A.raw_data?(a(),x(u,{key:0,data:e.getWorkflowData(),title:"Workflow & Response Data",description:"Complete workflow information including responses, participants, and status transitions","show-copy":!0,"show-download":!0,collapsible:!0,collapsed:!0},null,8,["data"])):d("",!0)])])]}),_:1}),p(T,{name:"comments"},{label:y(()=>[s[75]||(s[75]=f(" Comments ",-1)),e.comments&&e.comments.length?(a(),i("span",ii,"("+n(e.comments.length)+")",1)):d("",!0)]),default:y(()=>[t("div",ni,[t("div",li,[t("div",ri,[e.comments&&e.comments.length>0?(a(),x(D,{key:0,type:"success",size:"small"},{default:y(()=>[f(" Loaded "+n(e.comments.length)+" Comments ",1)]),_:1})):e.comments&&e.comments.length===0?(a(),x(D,{key:1,type:"info",size:"small"},{default:y(()=>[...s[76]||(s[76]=[f(" No Comments Available ",-1)])]),_:1})):(a(),x(D,{key:2,type:"warning",size:"small"},{default:y(()=>[...s[77]||(s[77]=[f(" Comments Not Loaded ",-1)])]),_:1}))]),t("div",di,[p(F,{type:"info",size:"small",icon:"Refresh",loading:e.commentsLoading,onClick:e.loadComments},{default:y(()=>[f(n(e.comments?"Refresh":"Load")+" Comments ",1)]),_:1},8,["loading","onClick"])])]),e.commentsLoading?(a(),i("div",ci,[...s[78]||(s[78]=[t("div",{class:"spinner-small"},null,-1),t("p",null,"Loading comments...",-1)])])):e.comments&&e.comments.length>0?(a(),i("div",mi,[(a(!0),i(M,null,B(e.comments,k=>(a(),i("div",{key:k.id,class:"comment-item"},[t("div",ui,[t("div",_i,[t("span",vi,n(e.getUserDisplayName(k.author)),1)]),t("div",fi,[t("span",yi,n(e.formatDateTime(k.created_at)),1),k.is_draft?(a(),x(D,{key:0,type:"warning",size:"small"},{default:y(()=>[...s[79]||(s[79]=[f("Draft",-1)])]),_:1})):d("",!0),p(D,{type:k.type==="response"?"success":"info",size:"small"},{default:y(()=>[f(n(k.type==="response"?"Official Response":"Comment"),1)]),_:2},1032,["type"])])]),t("div",gi,[k.content&&k.content.trim()?(a(),i("div",wi,n(k.content),1)):(a(),i("div",pi,[p(se,{title:"Empty Content",type:"warning",closable:!1,size:"small"},{default:y(()=>[...s[80]||(s[80]=[f(" This comment has no text content ",-1)])]),_:1})]))])]))),128))])):e.comments&&e.comments.length===0?(a(),i("div",hi,[p(ee,{description:"No comments available"})])):d("",!0),t("div",ki,[e.comments?(a(),x(u,{key:0,data:e.comments,title:"Comments Data",description:"JSON data of current RFI's comments list","show-copy":!0,"show-download":!0,collapsible:!0,collapsed:!0},null,8,["data"])):d("",!0)])])]),_:1}),p(T,{name:"api-data"},{label:y(()=>[...s[81]||(s[81]=[f(" API Data ",-1)])]),default:y(()=>[t("div",bi,[t("div",Ii,[t("div",Ri,[e.item?(a(),x(u,{key:0,data:e.item,title:"RFI Basic Data",description:"Complete RFI information including all fields and metadata","show-copy":!0,"show-download":!0,collapsible:!0,collapsed:!1},null,8,["data"])):d("",!0)]),e.attachments&&e.attachments.length>0?(a(),i("div",Di,[p(u,{data:e.attachments,title:"Attachments Data",description:"Complete attachments information for this RFI","show-copy":!0,"show-download":!0,collapsible:!0,collapsed:!0},null,8,["data"])])):d("",!0),e.comments&&e.comments.length>0?(a(),i("div",Ai,[p(u,{data:e.comments,title:"Comments Data",description:"Complete comments information for this RFI","show-copy":!0,"show-download":!0,collapsible:!0,collapsed:!0},null,8,["data"])])):d("",!0),t("div",Ci,[p(u,{data:e.apiCallsInfo,title:"API Call Information",description:"Information about API calls made to load this RFI data","show-copy":!0,"show-download":!1,collapsible:!0,collapsed:!0},null,8,["data"])])])])]),_:1})]),_:1},8,["modelValue"])])])):(a(),i("div",ji,[s[83]||(s[83]=t("div",{class:"error-icon"},"âš ï¸",-1)),s[84]||(s[84]=t("h3",null,"Failed to Load RFI Details",-1)),s[85]||(s[85]=t("p",null,"Unable to load the RFI information. Please try again.",-1)),p(F,{type:"primary",onClick:e.loadData},{default:y(()=>[...s[82]||(s[82]=[f("Retry",-1)])]),_:1},8,["onClick"])]))])}const Ni=he(Ot,[["render",Fi],["__scopeId","data-v-3bc4a2bf"]]);export{Ni as default};
